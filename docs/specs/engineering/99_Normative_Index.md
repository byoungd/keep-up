# Normative Requirements Index - v0.9 RC

**Applies to:** LFCC v0.9 RC
**Last updated:** 2026-01-01

This index enumerates all normative requirements containing MUST/MUST NOT/REQUIRED/SHALL/SHALL NOT across the LFCC v0.9 RC specification and engineering docs.
Each entry links to the source section and records the originating line for traceability.

---

- REQ-001: ## 0. Non-Negotiable Guarantees (MUST) (Source: [0. Non-Negotiable Guarantees (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#0-non-negotiable-guarantees-must), line 17)
- REQ-002: 2. **No silent drift:** annotations MUST NOT silently reattach to unrelated content. (Source: [0. Non-Negotiable Guarantees (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#0-non-negotiable-guarantees-must), line 20)
- REQ-003: 6. **Fail-closed shared truth:** if correctness cannot be proven, shared metadata MUST NOT guess. (Source: [0. Non-Negotiable Guarantees (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#0-non-negotiable-guarantees-must), line 28)
- REQ-004: ## 1. Global Invariants (MUST) (Source: [1. Global Invariants (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#1-global-invariants-must), line 32)
- REQ-005: **INV-COORD-002:** Operations MUST NOT split surrogate pairs; if a boundary lands mid-pair -> fail closed. (Source: [1.1 Canonical Coordinates](../Local-First_Collaboration_Contract_v0.9_RC.md#11-canonical-coordinates), line 36)
- REQ-006: **INV-COORD-003:** Surrogate pair detection MUST be performed before any position-based operation. (Source: [UTF-16 Surrogate Pair Handling (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#utf-16-surrogate-pair-handling-normative), line 39)
- REQ-007: **Detection Algorithm (REQUIRED):** (Source: [UTF-16 Surrogate Pair Handling (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#utf-16-surrogate-pair-handling-normative), line 46)
- REQ-008: - If `pos` points to a high surrogate (0xD800-0xDBFF), it MUST be the start of a valid pair (Source: [UTF-16 Surrogate Pair Handling (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#utf-16-surrogate-pair-handling-normative), line 48)
- REQ-009: - If `pos` points to a low surrogate (0xDC00-0xDFFF), it MUST be the second unit of a valid pair (Source: [UTF-16 Surrogate Pair Handling (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#utf-16-surrogate-pair-handling-normative), line 49)
- REQ-010: - If `pos` is between a high and low surrogate, the operation MUST fail closed (Source: [UTF-16 Surrogate Pair Handling (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#utf-16-surrogate-pair-handling-normative), line 50)
- REQ-011: 2. Range operations MUST validate both start and end positions: (Source: [UTF-16 Surrogate Pair Handling (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#utf-16-surrogate-pair-handling-normative), line 52)
- REQ-012: **INV-SAFE-001:** If mapping/target cannot be proven, the system MUST NOT guess for shared truth. (Source: [1.3 Determinism & Fail-Closed](../Local-First_Collaboration_Contract_v0.9_RC.md#13-determinism-fail-closed), line 75)
- REQ-013: ## 2. Policy Manifest + Capabilities + Negotiation (REQUIRED) (Source: [2. Policy Manifest + Capabilities + Negotiation (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#2-policy-manifest-capabilities-negotiation-required), line 79)
- REQ-014: ### 2.2 Negotiation (REQUIRED) (Source: [2.2 Negotiation (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#22-negotiation-required), line 176)
- REQ-015: **NEG-001:** Negotiation MUST be deterministic and commutative. (Source: [2.2 Negotiation (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#22-negotiation-required), line 183)
- REQ-016: **NEG-002:** Disabled features MUST degrade safely (see Section 12), not hard-refuse, **unless** correctness-critical fields mismatch. (Source: [2.2 Negotiation (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#22-negotiation-required), line 184)
- REQ-017: 1. **Schema validation:** All manifests MUST validate against the v0.9 schema. (Source: [2.2.1 Deterministic Negotiation Algorithm (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#221-deterministic-negotiation-algorithm-normative), line 187)
- REQ-018: 2. **Hard-refusal fields:** All participants MUST match exactly on: (Source: [2.2.1 Deterministic Negotiation Algorithm (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#221-deterministic-negotiation-algorithm-normative), line 188)
- REQ-019: 3. **Unknown fields:** Any unknown top-level field MUST be rejected unless it lives under `extensions`. (Source: [2.2.1 Deterministic Negotiation Algorithm (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#221-deterministic-negotiation-algorithm-normative), line 193)
- REQ-020: then co-edit MUST be refused (read-only is allowed). (Source: [2.3 Non-Negotiable Mismatches (Hard Refusal)](../Local-First_Collaboration_Contract_v0.9_RC.md#23-non-negotiable-mismatches-hard-refusal), line 207)
- REQ-021: ## 3. Core Data Model (REQUIRED) (Source: [3. Core Data Model (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#3-core-data-model-required), line 211)
- REQ-022: ### 3.1 Blocks (REQUIRED) (Source: [3.1 Blocks (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#31-blocks-required), line 213)
- REQ-023: ### 3.2 Annotations (REQUIRED) (Source: [3.2 Annotations (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#32-annotations-required), line 227)
- REQ-024: Cross-block annotations MUST use SpanList. (Source: [3.2 Annotations (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#32-annotations-required), line 228)
- REQ-025: **SPAN-001:** Each span MUST be within exactly one block. (Source: [3.2 Annotations (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#32-annotations-required), line 262)
- REQ-026: **SPAN-002:** Span order MUST be preserved; no reordering. (Source: [3.2 Annotations (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#32-annotations-required), line 263)
- REQ-027: ## 4. Block Identity + Operation Taxonomy (REQUIRED) (Source: [4. Block Identity + Operation Taxonomy (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#4-block-identity-operation-taxonomy-required), line 267)
- REQ-028: ### 4.1 Operation Codes (REQUIRED) (Source: [4.1 Operation Codes (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#41-operation-codes-required), line 269)
- REQ-029: Each editor transaction MUST be classified by op codes (deterministically): (Source: [4.1 Operation Codes (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#41-operation-codes-required), line 270)
- REQ-030: #### 4.1.1 Concurrent Structural Operations (REQUIRED) (Source: [4.1.1 Concurrent Structural Operations (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#411-concurrent-structural-operations-required), line 274)
- REQ-031: When multiple structural operations target the same or overlapping blocks, implementations MUST apply deterministic ordering. (Source: [4.1.1 Concurrent Structural Operations (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#411-concurrent-structural-operations-required), line 275)
- REQ-032: - BlockMapping MUST account for all pending structural changes (Source: [4.1.1 Concurrent Structural Operations (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#411-concurrent-structural-operations-required), line 290)
- REQ-033: ### 4.2 Block Identity State Machine (REQUIRED) (Source: [4.2 Block Identity State Machine (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#42-block-identity-state-machine-required), line 305)
- REQ-034: Implementations MUST follow KEEP-ID / REPLACE-ID / retirement rules: (Source: [4.2 Block Identity State Machine (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#42-block-identity-state-machine-required), line 306)
- REQ-035: **BLOCKID-001:** Any override MUST be versioned in `block_id_policy.overrides` and gated by tests. (Source: [4.2 Block Identity State Machine (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#42-block-identity-state-machine-required), line 311)
- REQ-036: ## 5. Stable Anchors (REQUIRED) (Source: [5. Stable Anchors (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#5-stable-anchors-required), line 315)
- REQ-037: Adapters MUST provide: (Source: [5. Stable Anchors (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#5-stable-anchors-required), line 317)
- REQ-038: **ANCHOR-ENC-001:** Anchor encoding MUST be stable and versioned. (Source: [5. Stable Anchors (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#5-stable-anchors-required), line 321)
- REQ-039: **ANCHOR-ENC-002:** Anchor encoding MUST include a checksum; decoders MUST verify it and reject invalid anchors (return unresolved). (Source: [5. Stable Anchors (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#5-stable-anchors-required), line 322)
- REQ-040: ## 6. Chain Policies + Hashes (REQUIRED) (Source: [6. Chain Policies + Hashes (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#6-chain-policies-hashes-required), line 326)
- REQ-041: #### 6.1.1 Chain Policy Degradation (REQUIRED) (Source: [6.1.1 Chain Policy Degradation (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#611-chain-policy-degradation-required), line 333)
- REQ-042: When negotiation results in a more restrictive chain policy, existing annotations MUST be migrated deterministically. (Source: [6.1.1 Chain Policy Degradation (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#611-chain-policy-degradation-required), line 334)
- REQ-043: ## 7. BlockMapping + Dirty-Region Reconciliation (REQUIRED) (Source: [7. BlockMapping + Dirty-Region Reconciliation (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#7-blockmapping-dirty-region-reconciliation-required), line 375)
- REQ-044: ### 7.1 BlockMapping Interface (REQUIRED) (Source: [7.1 BlockMapping Interface (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#71-blockmapping-interface-required), line 377)
- REQ-045: ### 7.2 Axioms (MUST) (Source: [7.2 Axioms (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#72-axioms-must), line 389)
- REQ-046: - **Determinism:** Given the same operation and document state, `mapOldToNew` MUST return the same result across all replicas. (Source: [7.2 Axioms (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#72-axioms-must), line 390)
- REQ-047: - **Locality:** Mapping MUST NOT use heuristics or jump to non-adjacent positions. Positions map to nearby positions only. (Source: [7.2 Axioms (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#72-axioms-must), line 391)
- REQ-048: - **Coverage:** For KEEP-ID edits (text/mark edits within a block), all positions in the old block MUST have valid mappings. (Source: [7.2 Axioms (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#72-axioms-must), line 393)
- REQ-049: - **Deletion semantics:** Negative deltas represent delete intervals in old coordinates; positions inside a deleted interval MUST map to `null`. Monotonicity and coverage apply to non-null results. (Source: [7.2 Axioms (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#72-axioms-must), line 394)
- REQ-050: - Implementations MUST provide property-based tests verifying all axioms for each operation type (Source: [7.2 Axioms (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#72-axioms-must), line 397)
- REQ-051: - BlockMapping generation MUST be deterministic and reproducible (Source: [7.2 Axioms (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#72-axioms-must), line 398)
- REQ-052: - Performance: Mapping generation MUST complete in O(N) time where N is the number of affected blocks (Source: [7.2 Axioms (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#72-axioms-must), line 399)
- REQ-053: ### 7.3 DirtyInfo (REQUIRED) (Source: [7.3 DirtyInfo (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#73-dirtyinfo-required), line 422)
- REQ-054: Bridge MUST expose minimal affected structure: (Source: [7.3 DirtyInfo (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#73-dirtyinfo-required), line 423)
- REQ-055: ### 7.4 Deterministic Neighbor Expansion (MUST) (Source: [7.4 Deterministic Neighbor Expansion (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#74-deterministic-neighbor-expansion-must), line 434)
- REQ-056: Reconciliation MUST expand `touchedBlocks` by `K` neighbor content blocks on both sides (manifest controlled). (Source: [7.4 Deterministic Neighbor Expansion (MUST)](../Local-First_Collaboration_Contract_v0.9_RC.md#74-deterministic-neighbor-expansion-must), line 435)
- REQ-057: Dev builds MUST support adaptive-with-coverage checks plus a manual "Force Full Scan" (see Section 13). (Source: [7.5 DEV Defensive Compare (Conformance-critical)](../Local-First_Collaboration_Contract_v0.9_RC.md#75-dev-defensive-compare-conformance-critical), line 438)
- REQ-058: ## 8. Canonicalizer Spec v2 - Recursive Canonicalization (REQUIRED) (Source: [8. Canonicalizer Spec v2 - Recursive Canonicalization (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#8-canonicalizer-spec-v2-recursive-canonicalization-required), line 442)
- REQ-059: **Canonical attribute rules (REQUIRED):** (Source: [8.1 Canonical Output Types (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#81-canonical-output-types-normative), line 470)
- REQ-060: - `href` MUST pass the URL policy in `ai_sanitization_policy`. (Source: [8.1 Canonical Output Types (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#81-canonical-output-types-normative), line 472)
- REQ-061: - Unknown attributes MUST be dropped during canonicalization with diagnostics. (Source: [8.1 Canonical Output Types (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#81-canonical-output-types-normative), line 473)
- REQ-062: **CANON-RECURSIVE-001:** Canonicalizer MUST traverse the document tree recursively. (Source: [8.1 Canonical Output Types (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#81-canonical-output-types-normative), line 475)
- REQ-063: **CANON-ALGO-001:** Marks MUST be treated as a set during flattening; nesting order must not affect output. (Source: [8.2 Algorithm (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#82-algorithm-normative), line 496)
- REQ-064: **CANON-ALGO-002:** `CanonBlock.children` order MUST be deterministic and reflect semantic order. (Source: [8.2 Algorithm (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#82-algorithm-normative), line 497)
- REQ-065: ## 9. Annotation Display State Machine (REQUIRED) (Source: [9. Annotation Display State Machine (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#9-annotation-display-state-machine-required), line 508)
- REQ-066: **STATE-001:** `active_unverified` and `broken_grace` MUST NOT be persisted. (Source: [9.1 Stored vs Display State (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#91-stored-vs-display-state-normative), line 514)
- REQ-067: ### 9.2 Tokenized Timers (REQUIRED) (Source: [9.2 Tokenized Timers (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#92-tokenized-timers-required), line 516)
- REQ-068: **TIMER-001:** Timers MUST be tokenized; stale timers MUST no-op. (Source: [9.2 Tokenized Timers (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#92-tokenized-timers-required), line 519)
- REQ-069: ### 9.3 History Integration (NEW, REQUIRED) (Source: [9.3 History Integration (NEW, REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#93-history-integration-new-required), line 521)
- REQ-070: **HISTORY-001:** Restored annotations MUST enter display via `active_unverified`. (Source: [9.3.1 Event: `HISTORY_RESTORE`](../Local-First_Collaboration_Contract_v0.9_RC.md#931-event-historyrestore), line 526)
- REQ-071: **HISTORY-002:** Restored annotations MUST NOT generate new IDs; they MUST revive stable UUIDs. (Source: [9.3.1 Event: `HISTORY_RESTORE`](../Local-First_Collaboration_Contract_v0.9_RC.md#931-event-historyrestore), line 527)
- REQ-072: **HISTORY-003:** Restore MUST skip `broken_grace` (no grace UI for restore). (Source: [9.3.1 Event: `HISTORY_RESTORE`](../Local-First_Collaboration_Contract_v0.9_RC.md#931-event-historyrestore), line 528)
- REQ-073: **HISTORY-004:** Restore MUST trigger a high-priority lazy verification checkpoint immediately (or ASAP). (Source: [9.3.1 Event: `HISTORY_RESTORE`](../Local-First_Collaboration_Contract_v0.9_RC.md#931-event-historyrestore), line 529)
- REQ-074: ## 10. Integrity Verification (Lazy + Checkpoints) (REQUIRED) (Source: [10. Integrity Verification (Lazy + Checkpoints) (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#10-integrity-verification-lazy-checkpoints-required), line 535)
- REQ-075: - Checkpoints MUST verify: (Source: [10. Integrity Verification (Lazy + Checkpoints) (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#10-integrity-verification-lazy-checkpoints-required), line 538)
- REQ-076: **PERF-001:** Hot path operations (text edits, mark edits) MUST complete in <10ms for documents with up to 10,000 blocks. (Source: [10.1 Performance Requirements (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#101-performance-requirements-normative), line 546)
- REQ-077: **PERF-002:** Checkpoint verification MUST be throttled: (Source: [10.1 Performance Requirements (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#101-performance-requirements-normative), line 548)
- REQ-078: **PERF-004:** Neighbor expansion MUST be O(K * N) where K is expansion radius and N is number of touched blocks. For large documents, implementations MAY use adaptive K based on document size and annotation density. (Source: [10.1 Performance Requirements (Normative)](../Local-First_Collaboration_Contract_v0.9_RC.md#101-performance-requirements-normative), line 559)
- REQ-079: ## 11. AI Gateway + Dry-Run Sanitization (REQUIRED when AI ops enabled) (Source: [11. AI Gateway + Dry-Run Sanitization (REQUIRED when AI ops enabled)](../Local-First_Collaboration_Contract_v0.9_RC.md#11-ai-gateway-dry-run-sanitization-required-when-ai-ops-enabled), line 563)
- REQ-080: AI MUST target stable IDs only: (Source: [11.1 Targeting Safety (Recap)](../Local-First_Collaboration_Contract_v0.9_RC.md#111-targeting-safety-recap), line 568)
- REQ-081: AI write requests MUST include: (Source: [11.1 Targeting Safety (Recap)](../Local-First_Collaboration_Contract_v0.9_RC.md#111-targeting-safety-recap), line 572)
- REQ-082: ### 11.2 AI Payload Dry-Run (NEW, REQUIRED) (Source: [11.2 AI Payload Dry-Run (NEW, REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#112-ai-payload-dry-run-new-required), line 578)
- REQ-083: Before applying any AI-generated content, the bridge MUST perform a **dry-run pipeline**: (Source: [11.2 AI Payload Dry-Run (NEW, REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#112-ai-payload-dry-run-new-required), line 580)
- REQ-084: **AI-SANITIZE-001:** Bridge MUST reject or sanitize AI payloads containing non-canonical structure or marks before applying. (Source: [11.2 AI Payload Dry-Run (NEW, REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#112-ai-payload-dry-run-new-required), line 595)
- REQ-085: **AI-DRYRUN-001:** Dry-run MUST be performed before any real editor mutation. (Source: [11.2 AI Payload Dry-Run (NEW, REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#112-ai-payload-dry-run-new-required), line 596)
- REQ-086: **AI-DRYRUN-002:** Failure MUST be fail-closed (no partial apply). (Source: [11.2 AI Payload Dry-Run (NEW, REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#112-ai-payload-dry-run-new-required), line 597)
- REQ-087: Relocation MUST NOT write shared repair updates without explicit user confirmation. (Source: [11.3 Smart Retry Guidance (Client, SHOULD)](../Local-First_Collaboration_Contract_v0.9_RC.md#113-smart-retry-guidance-client-should), line 606)
- REQ-088: ## 12. Compatibility Degradation (REQUIRED) (Source: [12. Compatibility Degradation (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#12-compatibility-degradation-required), line 610)
- REQ-089: ## 13. Developer Tooling + Conformance (REQUIRED) (Source: [13. Developer Tooling + Conformance (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#13-developer-tooling-conformance-required), line 622)
- REQ-090: ### 13.1 Developer Overrides (REQUIRED) (Source: [13.1 Developer Overrides (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#131-developer-overrides-required), line 624)
- REQ-091: **DEV-UX-001:** Debug overlay MUST provide **"Force Full Integrity Scan"**: (Source: [13.1 Developer Overrides (REQUIRED)](../Local-First_Collaboration_Contract_v0.9_RC.md#131-developer-overrides-required), line 625)
- REQ-092: ### 13.2 State Machine Visualization (REQUIRED when enabled) (Source: [13.2 State Machine Visualization (REQUIRED when enabled)](../Local-First_Collaboration_Contract_v0.9_RC.md#132-state-machine-visualization-required-when-enabled), line 630)
- REQ-093: **DEV-VIS-001:** Dev overlay MUST expose: (Source: [13.2 State Machine Visualization (REQUIRED when enabled)](../Local-First_Collaboration_Contract_v0.9_RC.md#132-state-machine-visualization-required-when-enabled), line 631)
- REQ-094: **KERNEL-VER-001:** Kernel APIs and policies MUST be versioned in lockstep with LFCC minor versions (0.x) and with stable 1.x when LFCC reaches 1.0. (Source: [14.2 Versioning](../Local-First_Collaboration_Contract_v0.9_RC.md#142-versioning), line 680)
- REQ-095: **Canonical attribute rules (REQUIRED):** (Source: [2.1 Canonical Types (Normative)](01_Kernel_API_Specification.md#21-canonical-types-normative), line 88)
- REQ-096: - `href` MUST pass the URL policy in `ai_sanitization_policy`. (Source: [2.1 Canonical Types (Normative)](01_Kernel_API_Specification.md#21-canonical-types-normative), line 90)
- REQ-097: - Unknown attributes MUST be dropped during canonicalization with diagnostics. (Source: [2.1 Canonical Types (Normative)](01_Kernel_API_Specification.md#21-canonical-types-normative), line 91)
- REQ-098: The canonicalizer MUST accept a platform-independent input model: (Source: [2.3 Input Abstraction](01_Kernel_API_Specification.md#23-input-abstraction), line 107)
- REQ-099: - Kernel exports MUST be versioned and tied to LFCC minor versions during 0.x. (Source: [7. Versioning Rules](01_Kernel_API_Specification.md#7-versioning-rules), line 379)
- REQ-100: - Any behavior changes MUST bump `canonicalizer_policy.version`, `ai_sanitization_policy.version`, etc. (Source: [7. Versioning Rules](01_Kernel_API_Specification.md#7-versioning-rules), line 380)
- REQ-101: **KERNEL-VER-001:** Kernel APIs and policy versions MUST evolve together with LFCC. (Source: [7. Versioning Rules](01_Kernel_API_Specification.md#7-versioning-rules), line 382)
- REQ-102: - If `bounded_gap=false` in effective caps -> chain kind MUST degrade to `strict_adjacency`. (Source: [3. Negotiation Pseudocode (Normative Reference)](02_Policy_Manifest_Schema.md#3-negotiation-pseudocode-normative-reference), line 410)
- REQ-103: - Unknown top-level fields MUST be rejected unless under `extensions`. (Source: [3. Negotiation Pseudocode (Normative Reference)](02_Policy_Manifest_Schema.md#3-negotiation-pseudocode-normative-reference), line 412)
- REQ-104: Bridge MUST classify each transaction into one or more op codes: (Source: [3. Typed Operations (Op Taxonomy)](03_Shadow_Model_and_Bridge_Architecture.md#3-typed-operations-op-taxonomy), line 77)
- REQ-105: Mode B MUST pass canonical equivalence checks using the v0.9 canonicalizer: (Source: [5. Mode B Conformance ("Semantic Double-Blind")](03_Shadow_Model_and_Bridge_Architecture.md#5-mode-b-conformance-semantic-double-blind), line 122)
- REQ-106: These are derived locally and MUST NOT be persisted: (Source: [1.2 Display (UI-only) Overlay States](04_Annotation_State_Machine_and_UX_Spec.md#12-display-ui-only-overlay-states), line 31)
- REQ-107: Decoration keys MUST be stable and deterministic: (Source: [5.1 Deterministic decoration keys](04_Annotation_State_Machine_and_UX_Spec.md#51-deterministic-decoration-keys), line 122)
- REQ-108: - **HISTORY-002:** Restore MUST revive stable UUIDs (no new IDs). (Source: [1. Normative Rules (Recap)](05_History_Integration_Guide.md#1-normative-rules-recap), line 24)
- REQ-109: - **HISTORY-003:** Restore MUST skip `broken_grace`. (Source: [1. Normative Rules (Recap)](05_History_Integration_Guide.md#1-normative-rules-recap), line 25)
- REQ-110: - **HISTORY-004:** Restore MUST trigger a high-priority lazy verification checkpoint ASAP. (Source: [1. Normative Rules (Recap)](05_History_Integration_Guide.md#1-normative-rules-recap), line 26)
- REQ-111: Bridge MUST mark the transaction with: (Source: [2.1 Detecting Undo/Redo](05_History_Integration_Guide.md#21-detecting-undoredo), line 38)
- REQ-112: DirtyInfo MUST include affected container blocks (table_cell/list_item), and neighbor expansion will reconcile span chains. (Source: [4.2 Nested container restores (tables/lists)](05_History_Integration_Guide.md#42-nested-container-restores-tableslists), line 83)
- REQ-113: 1. AI requests MUST be **causally pinned** to a document frontier. (Source: [0. Principles](06_AI_Envelope_Specification.md#0-principles), line 12)
- REQ-114: 2. AI writes MUST include **span-level preconditions** (`if_match_context_hash`). (Source: [0. Principles](06_AI_Envelope_Specification.md#0-principles), line 13)
- REQ-115: 3. AI payloads MUST be **dry-run sanitized** before application. (Source: [0. Principles](06_AI_Envelope_Specification.md#0-principles), line 14)
- REQ-116: 4. Failures MUST be fail-closed; never partially apply a mixed-validity response. (Source: [0. Principles](06_AI_Envelope_Specification.md#0-principles), line 15)
- REQ-117: - Gateway MUST ensure its doc state is **at least** `doc_frontier` causally (read-your-writes barrier). (Source: [2.2 Semantics](06_AI_Envelope_Specification.md#22-semantics), line 53)
- REQ-118: - Gateway MUST enforce `ai_sanitization_policy.limits` and reject on limit violations. (Source: [2.2 Semantics](06_AI_Envelope_Specification.md#22-semantics), line 56)
- REQ-119: Relocation MUST NOT write shared repair updates without user confirmation. (Source: [5. Client Retry Guidance (Normative-Recommended)](06_AI_Envelope_Specification.md#5-client-retry-guidance-normative-recommended), line 117)
- REQ-120: **Compliance rule:** All required gates MUST pass in CI to advertise LFCC v0.9 RC conformance. (Source: [0.1 Compliance Gates (Normative)](08_Conformance_Test_Suite_Plan.md#01-compliance-gates-normative), line 30)
- REQ-121: It MUST NOT replace LFCC persistent `block_id`. (Source: [4. Canonical IDs](10_Recursive_Canonicalization_Deep_Dive.md#4-canonical-ids), line 101)
- REQ-122: When a surrogate pair violation occurs, implementations MUST log: (Source: [4.2 Diagnostic Information](12_UTF16_Surrogate_Pair_Handling.md#42-diagnostic-information), line 317)
- REQ-123: Operations MUST be ordered deterministically using the following tuple: (Source: [1.1 Deterministic Ordering](14_Concurrent_Operations_Handling.md#11-deterministic-ordering), line 20)
- REQ-124: When multiple structural operations affect the same block, BlockMapping MUST account for all operations in order. (Source: [4.1 Mapping Generation](14_Concurrent_Operations_Handling.md#41-mapping-generation), line 228)
- REQ-125: **REQUIRED:** Empty documents MUST canonicalize to a single empty paragraph block. (Source: [1.2 Canonical Form](16_Edge_Cases_and_Boundary_Conditions.md#12-canonical-form), line 26)
- REQ-126: Custom types MUST be registered in the policy manifest: (Source: [1.1 Policy Manifest Registration](17_Custom_Types_Extension_Guide.md#11-policy-manifest-registration), line 20)
- REQ-127: All custom types MUST be validated against their schemas: (Source: [2.1 Schema Validation](17_Custom_Types_Extension_Guide.md#21-schema-validation), line 71)
- REQ-128: **Whitelist Approach (REQUIRED):** (Source: [1.1 Sanitization Rules](18_Security_Best_Practices.md#11-sanitization-rules), line 20)
- REQ-129: **Protocol requirement:** These limits MUST be enforced according to `ai_sanitization_policy.limits`. (Source: [1.3 Resource Limits](18_Security_Best_Practices.md#13-resource-limits), line 65)
- REQ-130: **Protocol requirement:** Checksum validation is REQUIRED by ANCHOR-ENC-002. (Source: [3.1 Anchor Integrity](18_Security_Best_Practices.md#31-anchor-integrity), line 120)
- REQ-131: - **Anchor Integrity:** Anchors MUST include a CRC32 checksum. Decoders MUST fail-closed on mismatch. (Source: [1.3 Breaking Changes for v0.9](19_Version_Migration_Guide.md#13-breaking-changes-for-v09), line 45)
- REQ-132: - **AI Limits:** `ai_sanitization_policy.limits` (size, depth, attrs) is REQUIRED and strictly enforced. (Source: [1.3 Breaking Changes for v0.9](19_Version_Migration_Guide.md#13-breaking-changes-for-v09), line 47)
- REQ-133: 1. **Validation Rule:** Parsers MUST reject unknown top-level fields in `PolicyManifest`. (Source: [1.4 Extensions Pattern (Forward Compatibility)](19_Version_Migration_Guide.md#14-extensions-pattern-forward-compatibility), line 56)
- REQ-134: Implementations MUST reject data from future versions (fail-closed) unless contained in `extensions`. (Source: [3.2 Forward Compatibility](19_Version_Migration_Guide.md#32-forward-compatibility), line 146)
- REQ-135: **AIN-001:** AI-native features MUST be gated by negotiated capability flags and policy fields. (Source: [1. Compatibility and Negotiation](23_AI_Native_Extension.md#1-compatibility-and-negotiation), line 22)
- REQ-136: **AIN-002:** If AI-native is not negotiated, implementations MUST fall back to LFCC v0.9 AI behavior. (Source: [1. Compatibility and Negotiation](23_AI_Native_Extension.md#1-compatibility-and-negotiation), line 23)
- REQ-137: **GW-101:** Requests MUST include `request_id`, `agent_id`, `doc_frontier`, `preconditions`, and `ops_xml`. (Source: [2. AI Gateway v2 Envelope (AI-native)](23_AI_Native_Extension.md#2-ai-gateway-v2-envelope-ai-native), line 59)
- REQ-138: **GW-102:** Requests MUST include either `intent_id` or an inline `intent` object. (Source: [2. AI Gateway v2 Envelope (AI-native)](23_AI_Native_Extension.md#2-ai-gateway-v2-envelope-ai-native), line 60)
- REQ-139: **GW-103:** Gateways MUST enforce idempotency for `request_id` within a policy-defined window. (Source: [2. AI Gateway v2 Envelope (AI-native)](23_AI_Native_Extension.md#2-ai-gateway-v2-envelope-ai-native), line 61)
- REQ-140: **DET-AI-001:** AI-generated changes MUST be expressed as explicit LFCC operations. (Source: [3. Deterministic Execution Model](23_AI_Native_Extension.md#3-deterministic-execution-model), line 79)
- REQ-141: **DET-AI-002:** Replicas MUST be able to apply AI operations without invoking an LLM. (Source: [3. Deterministic Execution Model](23_AI_Native_Extension.md#3-deterministic-execution-model), line 80)
- REQ-142: **DET-AI-003:** AI metadata MUST NOT change canonical document state. (Source: [3. Deterministic Execution Model](23_AI_Native_Extension.md#3-deterministic-execution-model), line 81)
- REQ-143: **SEC-AI-001:** AI requests MUST be authenticated and authorized by policy. (Source: [4. Identity, Governance, and Data Access](23_AI_Native_Extension.md#4-identity-governance-and-data-access), line 87)
- REQ-144: **SEC-AI-002:** AI read access MUST be filtered by a data access policy before model invocation. (Source: [4. Identity, Governance, and Data Access](23_AI_Native_Extension.md#4-identity-governance-and-data-access), line 88)
- REQ-145: **PROV-001:** AI provenance metadata MUST be stored separately from canonical document state. (Source: [5. Provenance and Audit](23_AI_Native_Extension.md#5-provenance-and-audit), line 101)
- REQ-146: **AUD-001:** AI gateways MUST emit append-only audit records for accepted and rejected requests. (Source: [5. Provenance and Audit](23_AI_Native_Extension.md#5-provenance-and-audit), line 102)
- REQ-147: **COORD-001:** Coordination claims MUST be advisory and MUST NOT override LFCC conflict rules. (Source: [6. Multi-Agent Coordination (Optional)](23_AI_Native_Extension.md#6-multi-agent-coordination-optional), line 115)
- REQ-148: **MERGE-001:** AI-proposed merges MUST be persisted as explicit LFCC operations. (Source: [7. Semantic Merge (Optional)](23_AI_Native_Extension.md#7-semantic-merge-optional), line 126)
- REQ-149: **MERGE-002:** Automatic merges MUST respect a policy-defined confidence threshold. (Source: [7. Semantic Merge (Optional)](23_AI_Native_Extension.md#7-semantic-merge-optional), line 127)
- REQ-150: **TXN-001:** Multi-step AI edits SHOULD be wrapped in transactions when enabled. (Source: [8. Transactions (Optional)](23_AI_Native_Extension.md#8-transactions-optional), line 133)
- REQ-151: **TXN-002:** Transaction failure MUST follow the negotiated rollback strategy. (Source: [8. Transactions (Optional)](23_AI_Native_Extension.md#8-transactions-optional), line 134)
