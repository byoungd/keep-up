/* ============================================
   LFCC Editor Surface
   ============================================ */

@layer base {
  .lfcc-editor .ProseMirror {
    min-height: 280px;
    padding-left: 4.5rem; /* Reserve space for block hover gutter tools */
    padding-right: 2rem;
    font-family: var(--reader-font-family, var(--font-sans));
    font-size: var(--reader-font-size);
    line-height: var(--reader-line-height);
    white-space: pre-wrap;
    overflow-wrap: break-word;
    color: var(--color-foreground);
    background-color: transparent;
    outline: none;
    caret-color: var(--color-primary);
  }

  .lfcc-editor .ProseMirror ::selection {
    background-color: hsl(214 100% 92%);
    color: var(--color-foreground);
  }

  .dark .lfcc-editor .ProseMirror ::selection {
    background-color: hsl(214 60% 30% / 0.8);
  }

  .lfcc-editor .ProseMirror > * {
    margin: 0;
  }

  .lfcc-editor .ProseMirror > * + * {
    margin-top: 0.375em; /* Notion-like paragraph spacing (6px) */
  }

  /* Lists - Tighter density for checklists/bullets */
  .lfcc-editor .ProseMirror ul,
  .lfcc-editor .ProseMirror ol {
    margin-top: 0.25em;
  }

  /* Performance: Skip rendering off-screen blocks for large documents */
  .lfcc-editor .ProseMirror > * {
    content-visibility: auto;
    contain-intrinsic-size: auto 80px;
  }

  .lfcc-editor .ProseMirror > [data-block-id] {
    position: relative;
    padding: 0.125rem 0.75rem; /* Slight vertical padding for hover target */
    border-radius: 0.25rem; /* Professional micro-rounded corners */
    transition: background-color var(--duration-fast) var(--ease-smooth);
  }

  /* Removed ::before left border line - conflicts with Portal-based BlockHandle design */

  /* Ultra-subtle hover: minimal visual distraction during reading/editing */
  .lfcc-editor .ProseMirror > [data-block-id]:hover {
    background-color: hsl(var(--color-foreground) / 0.02);
  }

  .dark .lfcc-editor .ProseMirror > [data-block-id]:hover {
    background-color: hsl(0 0% 100% / 0.02);
  }

  /* Block movement flash animation - draws attention to moved block */
  @keyframes block-move-flash {
    0% {
      background-color: hsl(214 90% 68% / 0.25);
      box-shadow: 0 0 0 2px hsl(214 90% 68% / 0.15);
    }
    100% {
      background-color: transparent;
      box-shadow: none;
    }
  }

  @keyframes block-move-flash {
    0% {
      background-color: hsl(214 70% 50% / 0.2);
      box-shadow: 0 0 0 2px hsl(214 70% 50% / 0.12);
    }
    100% {
      background-color: transparent;
      box-shadow: none;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .lfcc-editor .ProseMirror > [data-block-id].block-just-moved {
      animation: none;
    }
  }

  .lfcc-editor .ProseMirror :where(p, h1, h2, h3, pre, blockquote, li) {
    margin: 0;
  }

  /* Headings - Notion style: Spacious top, closer bottom */
  .lfcc-editor .ProseMirror h1,
  .lfcc-editor .ProseMirror h2,
  .lfcc-editor .ProseMirror h3 {
    margin-top: 1.5em;
    margin-bottom: 0.25em;
    font-weight: 600;
    line-height: 1.3;
    letter-spacing: -0.015em;
  }

  /* First element shouldn't have top margin */
  .lfcc-editor .ProseMirror > *:first-child {
    margin-top: 0;
  }
  .lfcc-editor .ProseMirror h1 {
    font-size: 1.875rem;
    font-weight: 700;
    letter-spacing: -0.025em;
    line-height: 1.2;
    margin-top: 2rem;
    color: var(--color-foreground);
  }

  .lfcc-editor .ProseMirror h2 {
    font-size: 1.5rem;
    font-weight: 650;
    letter-spacing: -0.02em;
    line-height: 1.3;
    margin-top: 1.75rem;
    color: var(--color-foreground);
  }

  .lfcc-editor .ProseMirror h3 {
    font-size: 1.25rem;
    font-weight: 600;
    letter-spacing: -0.01em;
    line-height: 1.4;
    margin-top: 1.5rem;
    color: var(--color-foreground);
  }

  /* First child headings don't need top margin */
  .lfcc-editor .ProseMirror > [data-block-id]:first-child h1,
  .lfcc-editor .ProseMirror > [data-block-id]:first-child h2,
  .lfcc-editor .ProseMirror > [data-block-id]:first-child h3,
  .lfcc-editor .ProseMirror > h1:first-child,
  .lfcc-editor .ProseMirror > h2:first-child,
  .lfcc-editor .ProseMirror > h3:first-child {
    margin-top: 0;
  }

  /* Paragraphs - Optimal reading measure */
  .lfcc-editor .ProseMirror p {
    font-size: var(--reader-font-size, 1.05rem);
    line-height: var(--reader-line-height, 1.75);
    color: var(--color-foreground);
  }

  /* Links - Subtle but discoverable */
  .lfcc-editor .ProseMirror a {
    color: hsl(214 84% 56%);
    text-decoration: underline;
    text-decoration-color: hsl(214 84% 56% / 0.4);
    text-underline-offset: 2px;
    transition: text-decoration-color var(--duration-fast) var(--ease-smooth);
  }

  .lfcc-editor .ProseMirror a:hover {
    text-decoration-color: hsl(214 84% 56%);
  }

  .dark .lfcc-editor .ProseMirror a {
    color: hsl(214 84% 70%);
    text-decoration-color: hsl(214 84% 70% / 0.4);
  }

  .dark .lfcc-editor .ProseMirror a:hover {
    text-decoration-color: hsl(214 84% 70%);
  }

  /* Inline code - Refined styling */
  .lfcc-editor .ProseMirror code:not(pre code) {
    font-family: var(--font-mono);
    font-size: 0.875em;
    padding: 0.15em 0.4em;
    border-radius: 4px;
    background: var(--color-surface-2);
    color: hsl(340 65% 47%);
  }

  .dark .lfcc-editor .ProseMirror code:not(pre code) {
    background: var(--color-surface-3);
    color: hsl(340 65% 65%);
  }

  /* Lists - Better spacing and visual rhythm */
  .lfcc-editor .ProseMirror ul,
  .lfcc-editor .ProseMirror ol {
    padding-left: 1.5rem;
    list-style-position: outside;
  }

  .lfcc-editor .ProseMirror ul {
    list-style-type: disc;
  }

  .lfcc-editor .ProseMirror ol {
    list-style-type: decimal;
  }

  .lfcc-editor .ProseMirror li {
    padding-left: 0.25rem;
  }

  .lfcc-editor .ProseMirror li::marker {
    color: var(--color-muted-foreground);
  }

  /* Nested lists spacing */
  .lfcc-editor .ProseMirror li > ul,
  .lfcc-editor .ProseMirror li > ol {
    margin-top: 0.5rem;
  }

  .lfcc-editor .ProseMirror li[data-block-id] {
    position: relative;
    padding: 0.1rem 0.5rem;
    border-radius: 0.25rem;
  }

  /* Removed li ::before left border line - consistent with clean Portal design */

  .lfcc-editor .ProseMirror li[data-block-id]:hover {
    background-color: hsl(var(--color-foreground) / 0.02);
  }

  .dark .lfcc-editor .ProseMirror li[data-block-id]:hover {
    background-color: hsl(0 0% 100% / 0.02);
  }

  /* Code blocks - Professional syntax highlighting ready */
  .lfcc-editor .ProseMirror pre[data-block-id] {
    background: var(--color-surface-1);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 1rem 1.25rem;
    font-size: 0.875rem;
    font-family: var(--font-mono);
    line-height: 1.6;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .lfcc-editor .ProseMirror pre[data-block-id] code {
    background: transparent;
    padding: 0;
    color: inherit;
    font-size: inherit;
  }

  .dark .lfcc-editor .ProseMirror pre[data-block-id] {
    background: hsl(222 47% 8%);
    border-color: hsl(217.2 32.6% 20%);
  }

  /* Blockquote - Notion-style professional design */
  .lfcc-editor .ProseMirror blockquote[data-block-id] {
    position: relative;
    margin: 0;
    padding: 0.25rem 0 0.25rem 1rem;
    /* Notion-style: thick left border, neutral gray */
    border-left: 3px solid hsl(220 10% 80%);
    /* No background, no shadow, no roundness - pure content focus */
    background: transparent;
    /* Text slightly muted but readable */
    color: var(--color-foreground);
  }

  .dark .lfcc-editor .ProseMirror blockquote[data-block-id] {
    border-left-color: hsl(220 10% 35%);
  }

  .lfcc-editor .ProseMirror table {
    border-collapse: collapse;
    width: 100%;
    background: var(--color-surface-0);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    overflow: hidden;
  }

  .lfcc-editor .ProseMirror td,
  .lfcc-editor .ProseMirror th {
    border: 1px solid var(--color-border);
    padding: 0.5rem 0.75rem;
    vertical-align: top;
  }
}

/* ============================================
   Selection Toolbar Active States
   ============================================ */

@layer base {
  .lfcc-toolbar-active-bold [data-testid="selection-toolbar"] button[title="Bold"],
  .lfcc-toolbar-active-italic [data-testid="selection-toolbar"] button[title="Italic"],
  .lfcc-toolbar-active-code [data-testid="selection-toolbar"] button[title="Code"],
  .lfcc-toolbar-active-link [data-testid="selection-toolbar"] button[title="Link"],
  .lfcc-toolbar-active-h1 [data-testid="selection-toolbar"] button[title="Heading 1"],
  .lfcc-toolbar-active-h2 [data-testid="selection-toolbar"] button[title="Heading 2"],
  .lfcc-toolbar-active-list [data-testid="selection-toolbar"] button[title="List"],
  .lfcc-toolbar-active-quote [data-testid="selection-toolbar"] button[title="Quote"] {
    background-color: var(--color-primary);
    color: var(--color-primary-foreground);
  }
}

/* ============================================
   LFCC Annotation Highlighting
   ============================================ */

@layer base {
  /* ============================================
     Overlay Mode: Interaction-Only Decorations
     Visual rendering handled by HighlightOverlay component
     ============================================ */

  .lfcc-annotation-target {
    /* Transparent background - visuals rendered by overlay */
    background: transparent !important;
    box-shadow: none !important;
    /* Cursor to indicate interactivity */
    cursor: pointer;
    /* Ensure proper selection behavior */
    -webkit-box-decoration-break: clone;
    box-decoration-break: clone;
  }

  .lfcc-annotation-target--active,
  .lfcc-annotation-target--partial,
  .lfcc-annotation-target--unverified,
  .lfcc-annotation-target--grace {
    /* All states transparent in overlay mode */
    background: transparent !important;
  }

  /* Hover effect for interaction targets */
  .lfcc-annotation-target:hover {
    /* Subtle underline on hover for feedback */
    text-decoration: underline;
    text-decoration-color: rgba(0, 0, 0, 0.2);
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  /* ============================================
     Highlight Overlay Layer Styles
     ============================================ */

  .highlight-overlay {
    pointer-events: none;
  }

  .highlight-rect {
    /* Base styles for overlay highlight rectangles */
    pointer-events: none;
    mix-blend-mode: multiply;
  }

  .dark .highlight-rect {
    /* In dark mode, use screen blend for better visibility */
    mix-blend-mode: screen;
    opacity: 0.25 !important;
  }

  .highlight-rect--focused {
    /* Focus ring is applied via inline styles for dynamic color support */
    outline: none;
  }

  /* Multi-layer segment indicator (shown at overlap points) */
  .highlight-segment-indicator {
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 3px;
    border-radius: 1px;
    pointer-events: none;
  }

  /* ============================================
     Legacy Mode: Full Visual Decorations
     ============================================ */

  .lfcc-annotation {
    --anno-bg: var(--color-highlight-yellow);
    --anno-shadow: hsl(48 98% 78%);
    /* Zero-layout approach: no margin, no padding, no border-radius change */
    -webkit-box-decoration-break: clone;
    box-decoration-break: clone;
    background-color: var(--anno-bg);
    box-shadow: none;
    transition: background-color var(--duration-fast) var(--ease-smooth), box-shadow
      var(--duration-fast) var(--ease-smooth);
  }

  .lfcc-annotation--active {
    background-color: var(--anno-bg);
  }

  .lfcc-annotation--partial {
    background-image: repeating-linear-gradient(
      135deg,
      var(--anno-bg),
      var(--anno-bg) 6px,
      transparent 6px,
      transparent 10px
    );
    box-shadow: none;
  }

  .lfcc-annotation--unverified {
    background-color: var(--anno-bg);
    box-shadow: none;
  }

  .lfcc-annotation--grace {
    background-color: hsl(0 100% 96%);
    box-shadow: none;
  }

  .lfcc-annotation--orphan {
    background-color: hsl(220 10% 92%);
    box-shadow: none;
    opacity: 0.7;
  }

  /* Ghosted: faded source annotation during drag to avoid overlap with preview */
  /* Use transparent background instead of opacity to keep text fully visible */
  .lfcc-annotation--ghosted {
    background-color: transparent !important;
    box-shadow: none !important;
    transition: background-color 0.15s ease-out, box-shadow 0.15s ease-out;
  }

  .lfcc-annotation--yellow {
    --anno-bg: var(--lfcc-annotation-yellow);
    --anno-shadow: hsl(46 90% 72%);
  }

  .lfcc-annotation--green {
    --anno-bg: var(--lfcc-annotation-green);
    --anno-shadow: hsl(142 50% 60%);
  }

  .lfcc-annotation--red {
    --anno-bg: var(--lfcc-annotation-red);
    --anno-shadow: hsl(0 75% 68%);
  }

  .lfcc-annotation--purple {
    --anno-bg: var(--lfcc-annotation-purple);
    --anno-shadow: hsl(268 65% 72%);
  }

  .lfcc-annotation--panel-hover,
  .lfcc-annotation:hover {
    box-shadow: inset 0 -2px 0 var(--anno-shadow), 0 0 0 1px
      color-mix(in oklch, var(--anno-shadow) 60%, transparent);
  }

  .lfcc-annotation--focus {
    box-shadow: inset 0 -2px 0 var(--anno-shadow), 0 0 0 2px hsl(214 85% 65% / 0.7);
  }

  /* ============================================
     Drag Preview Overlay (External Portal)
     Renders outside ProseMirror to avoid text jank
     ============================================ */

  .annotation-drag-overlay {
    /* Styles set inline via React */
    pointer-events: none;
  }

  .annotation-preview {
    /* Lower opacity for better text readability during drag */
    background: hsl(46 100% 55% / 0.25);
    border-radius: 2px;
    /* Add subtle border to maintain visual definition */
    box-shadow: inset 0 0 0 1px hsl(46 90% 50% / 0.5);
  }

  .annotation-preview--yellow {
    background: hsl(46 100% 55% / 0.25);
    box-shadow: inset 0 0 0 1px hsl(46 90% 50% / 0.5);
  }

  .annotation-preview--green {
    background: hsl(142 50% 50% / 0.25);
    box-shadow: inset 0 0 0 1px hsl(142 50% 45% / 0.5);
  }

  .annotation-preview--red {
    background: hsl(0 75% 55% / 0.25);
    box-shadow: inset 0 0 0 1px hsl(0 75% 50% / 0.5);
  }

  .annotation-preview--purple {
    background: hsl(268 65% 55% / 0.25);
    box-shadow: inset 0 0 0 1px hsl(268 65% 50% / 0.5);
  }

  .annotation-preview-handle {
    background: hsl(46 90% 55%);
    border-radius: 3px;
    /* Height set by inline style to match actual line height */
    box-shadow: 0 0 0 1.5px rgba(255, 255, 255, 0.7), 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  .annotation-preview-handle--start {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }

  .annotation-preview-handle--end {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }

  .annotation-preview-handle--active {
    border-radius: 6px !important;
    z-index: 100;
    transition: transform 50ms ease-out;
  }

  .annotation-preview-handle--yellow {
    background: hsl(46 90% 55%);
  }

  .annotation-preview-handle--green {
    background: hsl(142 50% 50%);
  }

  .annotation-preview-handle--red {
    background: hsl(0 75% 55%);
  }

  .annotation-preview-handle--purple {
    background: hsl(268 65% 55%);
  }

  /* 
   * Handle Design Philosophy:
   * 1. Minimal by default - don't distract from reading
   * 2. Color-matched - blend with highlight, not fight it
   * 3. Show on interaction - appear when user needs them
   * 4. Mobile-friendly - larger touch targets on touch devices
   */
  .lfcc-annotation-handle {
    /* CRITICAL: Must be completely zero-size in text flow */
    position: relative;
    display: inline;
    width: 0;
    height: 0;
    margin: 0;
    padding: 0;
    font-size: 0;
    line-height: 0;
    vertical-align: baseline;
    /* Visual pill is rendered via ::before with absolute position */
    cursor: ew-resize;
    z-index: 10;
    /* Hidden by default - show on hover/focus */
    opacity: 0;
    transition: opacity var(--duration-fast) var(--ease-smooth);
    /* Avoid hover thrash: only enable pointer events when handles are visible */
    pointer-events: none;
  }

  /* Show handles when annotation is focused, hovered, or being dragged */
  .lfcc-annotation-dragging .lfcc-annotation-handle {
    opacity: 0 !important;
    pointer-events: none !important;
  }

  .lfcc-annotation-dragging .lfcc-annotation-handle--dragging {
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  /* Show handles via adjacency or direct hover */
  .lfcc-annotation--focus + .lfcc-annotation-handle,
  .lfcc-annotation:hover + .lfcc-annotation-handle,
  .lfcc-annotation-handle:hover {
    opacity: 1;
    pointer-events: auto;
  }

  /* Handle visual - refined proportions for professional appearance */
  .lfcc-annotation-handle::before {
    content: "";
    position: absolute;
    /*
     * Position from baseline: the handle span sits at baseline (vertical-align: baseline).
     * We offset upward to align with the line's visual bounds.
     * Fine-tuned to match highlight rectangle exactly.
     */
    top: -1.15rem;
    /* Default centering */
    left: -3px;
    width: 6px;
    /* Default height for body text */
    height: 1.4rem;
    /* Default rounded */
    border-radius: 3px;
    /* Warm color matching annotation highlight */
    background: color-mix(in oklch, var(--anno-shadow, hsl(46 90% 55%)) 85%, hsl(30 40% 35%));
    /* Subtle outer glow for depth */
    box-shadow: 0 0 0 1.5px color-mix(in oklch, var(--anno-bg, hsl(48 100% 88%)) 70%, white), 0 1px
      2px rgba(0, 0, 0, 0.1);
    opacity: 0.75;
    transition: transform var(--duration-fast) var(--ease-spring), box-shadow var(--duration-fast)
      var(--ease-smooth), opacity var(--duration-fast) var(--ease-smooth);
    /* Enable pointer events on the visual element */
    pointer-events: auto;
  }

  /* Start handle specific styling */
  .lfcc-annotation-handle--start::before {
    /* Align to left of character */
    left: -6px;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }

  /* End handle specific styling */
  .lfcc-annotation-handle--end::before {
    /* Align to right of character */
    left: 0;
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }

  /* Heading-specific handle sizing - scale with text size */
  /* Fine-tuned top offsets for perfect alignment */
  h1 .lfcc-annotation-handle::before {
    height: 2.25rem;
    top: -1.8rem;
  }
  h2 .lfcc-annotation-handle::before {
    height: 1.95rem;
    top: -1.57rem;
  }
  h3 .lfcc-annotation-handle::before {
    height: 1.75rem;
    top: -1.41rem;
  }

  /* Hover effect - subtle grow with enhanced shadow */
  .lfcc-annotation-handle:hover::before {
    transform: scale(1.2);
    background: color-mix(in oklch, var(--anno-shadow, hsl(46 90% 55%)) 100%, hsl(30 40% 30%));
    box-shadow: 0 0 0 2px color-mix(in oklch, var(--anno-bg, hsl(48 100% 88%)) 80%, white), 0 2px
      4px rgba(0, 0, 0, 0.15);
    opacity: 0.9;
  }

  /* Dark mode adjustments */
  .dark .lfcc-annotation-handle::before {
    background: color-mix(in oklch, var(--anno-shadow, hsl(46 90% 55%)) 80%, hsl(0 0% 60%));
    box-shadow: 0 0 0 1.5px color-mix(in oklch, var(--anno-bg, hsl(48 100% 30%)) 50%, transparent),
      0 1px 3px rgba(0, 0, 0, 0.3);
  }

  .dark .lfcc-annotation-handle:hover::before {
    box-shadow: 0 0 0 2px color-mix(in oklch, var(--anno-bg, hsl(48 100% 30%)) 60%, transparent), 0
      2px 5px rgba(0, 0, 0, 0.4);
  }

  /* Mobile: larger touch targets */
  @media (pointer: coarse) {
    .lfcc-annotation-handle::before {
      width: 12px;
      /* Match desktop proportions */
      height: 1.4rem;
      top: -1.15rem;
      border-radius: 5px;
      box-shadow: 0 0 0 3px color-mix(in oklch, var(--anno-bg, hsl(48 100% 88%)) 80%, white), 0 3px
        8px rgba(0, 0, 0, 0.25);
    }

    /* Heading-specific handle sizing on mobile */
    h1 .lfcc-annotation-handle::before {
      height: 2.25rem;
      top: -1.8rem;
    }
    h2 .lfcc-annotation-handle::before {
      height: 1.95rem;
      top: -1.57rem;
    }
    h3 .lfcc-annotation-handle::before {
      height: 1.75rem;
      top: -1.41rem;
    }

    /* Always show handles on touch devices for discoverability */
    .lfcc-annotation--focus .lfcc-annotation-handle,
    .lfcc-annotation:active .lfcc-annotation-handle {
      opacity: 1;
      pointer-events: auto;
    }
  }

  .lfcc-annotation-dragging {
    cursor: ew-resize;
    user-select: none;
  }

  /* Hide ALL ProseMirror handles during drag - overlay renders preview handles instead */
  .lfcc-annotation-dragging .lfcc-annotation-handle {
    opacity: 0 !important;
    pointer-events: none !important;
  }

  /* Suppress focus ring during drag */
  .lfcc-annotation-dragging .lfcc-annotation--focus {
    box-shadow: none;
  }

  .lfcc-annotation-dragging .lfcc-annotation {
    box-shadow: none;
  }

  .lfcc-annotation-dragging *:focus {
    outline: none;
  }

  .lfcc-gap {
    display: inline-block;
    margin: 0 0.25rem;
    padding: 0.05rem 0.4rem;
    border-radius: 999px;
    background: var(--color-surface-2);
    color: var(--color-muted-foreground);
    font-size: 0.75rem;
    line-height: 1;
  }

  .lfcc-gap--prominent {
    background: var(--color-surface-1);
    color: var(--color-foreground);
  }

  .lfcc-gap--required-order {
    border: 1px dashed var(--color-border);
  }
}

/* ============================================
   LFCC Debug Overlay
   ============================================ */

@layer base {
  .lfcc-debug-overlay {
    position: fixed;
    right: 1.25rem;
    bottom: 1.25rem;
    width: 340px;
    max-height: 80vh;
    overflow: auto;
    border-radius: 14px;
    border: 1px solid var(--color-border);
    background: var(--color-surface-0);
    box-shadow: 0 12px 30px hsl(220 14% 10% / 0.18);
    z-index: 60;
    font-size: 12px;
  }

  /* 
  Fix for LFCC selection bug:
  Hide annotation handles during selection to prevent them from interfering 
  with native browser selection (snapping issues).
  Class .is-selecting is toggled by annotationPlugin.ts
*/
  .ProseMirror.is-selecting .lfcc-annotation-handle {
    display: none !important;
  }

  .lfcc-debug-header {
    position: sticky;
    top: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.6rem 0.85rem;
    background: var(--color-surface-1);
    border-bottom: 1px solid var(--color-border);
  }

  .lfcc-debug-title {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--color-foreground);
  }

  .lfcc-debug-close {
    border: 0;
    background: transparent;
    color: var(--color-muted-foreground);
    cursor: pointer;
    font-size: 18px;
    line-height: 1;
  }

  .lfcc-debug-section {
    padding: 0.65rem 0.85rem;
    border-bottom: 1px solid var(--color-border);
  }

  .lfcc-debug-section:last-child {
    border-bottom: 0;
  }

  .lfcc-debug-section-header {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    width: 100%;
    color: var(--color-foreground);
  }

  .lfcc-debug-section-content {
    margin-top: 0.4rem;
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
  }

  .lfcc-debug-section-title {
    font-size: 11px;
    font-weight: 600;
  }

  .lfcc-debug-section-badge {
    font-size: 10px;
    padding: 0 0.4rem;
    border-radius: 999px;
    background: var(--color-surface-2);
    color: var(--color-muted-foreground);
  }

  .lfcc-debug-section-chevron {
    font-size: 11px;
    color: var(--color-muted-foreground);
  }

  .lfcc-debug-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-top: 0.35rem;
  }

  .lfcc-debug-label {
    font-size: 9px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--color-muted-foreground);
  }

  .lfcc-debug-value {
    font-size: 11px;
    color: var(--color-foreground);
  }

  .lfcc-debug-mono {
    font-family: var(--font-mono);
  }

  .lfcc-debug-small {
    font-size: 10px;
  }

  .lfcc-debug-muted {
    color: var(--color-muted-foreground);
  }

  .lfcc-debug-tag {
    padding: 0.1rem 0.35rem;
    border-radius: 999px;
    background: var(--color-surface-2);
    font-size: 10px;
  }

  .lfcc-debug-tag--ok {
    background: hsl(142 45% 90%);
    color: hsl(142 60% 30%);
  }

  .lfcc-debug-tag--warn {
    background: hsl(44 90% 90%);
    color: hsl(32 70% 35%);
  }

  .lfcc-debug-tag--error {
    background: hsl(0 80% 93%);
    color: hsl(0 70% 40%);
  }

  .lfcc-debug-tag--sm {
    font-size: 9px;
  }

  .lfcc-debug-divider {
    height: 1px;
    background: var(--color-border);
    margin: 0.5rem 0;
  }

  .lfcc-debug-sublist {
    margin-top: 0.35rem;
    padding-left: 0.6rem;
    border-left: 1px dashed var(--color-border);
  }

  .lfcc-debug-anno-list {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    margin-top: 0.45rem;
  }

  .lfcc-debug-anno-row {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    padding: 0.45rem 0.55rem;
    border-radius: 10px;
    border: 1px solid var(--color-border);
    background: var(--color-surface-0);
    text-align: left;
  }

  .lfcc-debug-anno-row--hover {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 1px color-mix(in oklab, var(--color-primary) 40%, transparent);
  }

  .lfcc-debug-anno-header {
    display: flex;
    align-items: center;
    gap: 0.35rem;
  }

  .lfcc-debug-anno-color {
    width: 8px;
    height: 8px;
    border-radius: 999px;
  }

  .lfcc-debug-anno-meta {
    display: flex;
    gap: 0.5rem;
    font-size: 10px;
    color: var(--color-muted-foreground);
  }

  .lfcc-debug-actions {
    display: flex;
    flex-direction: column;
    gap: 0.45rem;
  }

  .lfcc-debug-btn {
    border-radius: 8px;
    border: 1px solid var(--color-border);
    background: var(--color-surface-1);
    padding: 0.35rem 0.5rem;
    text-align: left;
    font-size: 11px;
    cursor: pointer;
  }

  .lfcc-debug-btn--active {
    border-color: var(--color-primary);
    box-shadow: inset 0 0 0 1px var(--color-primary);
  }

  .lfcc-debug-scan-result {
    font-size: 10px;
  }

  .lfcc-debug-scan-result--ok {
    color: hsl(142 70% 35%);
  }

  .lfcc-debug-scan-result--fail {
    color: hsl(0 70% 45%);
  }

  .lfcc-debug-copy-status {
    font-size: 10px;
    color: var(--color-muted-foreground);
  }

  .lfcc-debug-error {
    margin-top: 0.45rem;
    padding: 0.35rem 0.5rem;
    border-radius: 8px;
    border: 1px solid hsl(0 80% 85%);
    background: hsl(0 100% 96%);
  }

  .lfcc-debug-error-msg {
    margin-top: 0.25rem;
    font-size: 10px;
    color: hsl(0 55% 35%);
  }
}

/* ============================================
   Bold Stable Mode: GRAD-Axis Variable Font
   ============================================ */

/* Apply EditorFlex to editor surface when feature is enabled */
.lfcc-bold-stable-grad .lfcc-editor .ProseMirror {
  font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
  font-synthesis: none;
  /* font-variation-settings: "opsz" 14, "wdth" 100, "wght" 400, "GRAD" 0; */
}

/* Render bold via GRAD axis - no width change, visible under selection */
.lfcc-bold-stable-grad .lfcc-editor .ProseMirror strong {
  font-weight: 400 !important;
  letter-spacing: 0;
  -webkit-text-stroke: 0;
  text-shadow: 0.6px 0 0 currentColor;
  /* font-variation-settings: "opsz" 14, "wdth" 100, "wght" 400, "GRAD" 90; */
}

/* Preserve stable bold text-shadow during native selection */
.lfcc-bold-stable-grad .lfcc-editor .ProseMirror strong::selection {
  text-shadow: 0.6px 0 0 currentColor;
}

.dark .lfcc-bold-stable-grad .lfcc-editor .ProseMirror strong::selection {
  text-shadow: 0.6px 0 0 currentColor;
}

/* ============================================
   Focus Mode (Cmd+Shift+F)
   Distraction-free writing mode
   ============================================ */

@layer base {
  /* Hide chrome in focus mode */
  [data-focus-mode="true"] header,
  [data-focus-mode="true"] [data-sidebar],
  [data-focus-mode="true"] [data-panel="left"],
  [data-focus-mode="true"] [data-panel="right"],
  [data-focus-mode="true"] .sidebar-nav,
  [data-focus-mode="true"] .documents-panel,
  [data-focus-mode="true"] .ai-panel {
    display: none !important;
  }

  /* Center and expand the editor in focus mode */
  [data-focus-mode="true"] [data-editor-container],
  [data-focus-mode="true"] .editor-pane {
    max-width: 720px !important;
    margin-left: auto !important;
    margin-right: auto !important;
    width: 100% !important;
    flex: 1 !important;
  }

  /* Remove resize handles in focus mode */
  [data-focus-mode="true"] [data-resize-handle] {
    display: none !important;
  }

  /* Subtle vignette effect on edges */
  [data-focus-mode="true"]::before {
    content: "";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 50;
    background: radial-gradient(
      ellipse at center,
      transparent 60%,
      hsl(var(--background) / 0.3) 100%
    );
  }

  /* Focus mode indicator */
  [data-focus-mode="true"]::after {
    content: "Focus Mode";
    position: fixed;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px 12px;
    font-size: 10px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-muted-foreground);
    background: var(--color-surface-1);
    border: 1px solid var(--color-border);
    border-radius: 9999px;
    z-index: 51;
    opacity: 0.6;
    transition: opacity 0.2s ease;
  }

  [data-focus-mode="true"]:hover::after {
    opacity: 1;
  }
}
